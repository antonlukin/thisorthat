# То или Это: документация API

Все запросы к API должны выполняться через HTTPS и быть представлены в таком виде:

```
https://api.thisorthat.ru/<method_name>
```

Для всех запросов кроме `/register` поддерживаются HTTP методы **GET** и **POST**.  
Выбор HTTP метода ложится на плечи клиента, но стоит помнить, что запросы на изменение данных не должны кэшироваться.
Параметры запроса могут быть переданны одним из трех способов:

- [URL query string](https://en.wikipedia.org/wiki/Query_string)
- application/x-www-form-urlencoded
- multipart/form-data

Ответ содержит объект JSON, который всегда имеет логическое поле `ok`. Если `ok` равно true, значит запрос был выполнен успешно и результат запроса можно найти в поле `result`. В случае неудачного запроса, `ok` равно false и суть ошибки объясняется в поле `descriprion`. Некоторые ошибки могут также иметь необязательное поле `parameters`, которое может помочь автоматически обработать ошибку. Все такие случаи подробно описаны в пояснениях к конкретным методам.  
Для всех запросов сервер возвращает корректный [код состояния](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes) HTTP запроса.

- Все методы API не чувствительны к регистру
- Запросы должны выполняться с использованием кодировки UTF-8

Все методы кроме регистрации требуют обязательного параметра `token`, который клиент получает при регистрации.
При успешном вызове будет возвращен JSON-объект, содержащий результат.


## /register

Метод служит для регистрации клиента и получения токена авторизации.
Регистрацию следует выполнять только через **POST**.

#### Запрос

```
POST https://api.thisorthat.ru/register
```

#### Параметры запроса

| Параметр | Маска | Описание |
|----------|--------------|----------|
| **client** | `^[a-z0-9-_]{0,16}$` | Название клиента, с которого выполняется авторизация. |
| **uniqid** | `^[a-z0-9-_]{0,64}$` | Уникальное для платформы значение, идентификатор пользователя или uuid. |

> Все параметры запроса являются обязательными

#### Пример запроса

```bash
curl --include --request POST --data 'client=vkontakte&uniqid=5655655' 'https://api.thisorthat.ru/register'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "token": "1:0994f52572ab3f9432c77615c104db9c"
    }
}
```

В случае удачного выполнения запроса сервер возвращает параметр `token`, представляющий из себя `user_id`, отделенный двоеточием от 32-символьного хеша.


## /getItems

Возвращает список из **30** еще неотвеченных пользователем вопросов. Метод не возвращает отклоненные после модерации объекты.
> Этот метод может изменять полe базы данных.

#### Запрос

```
GET|POST https://api.thisorthat.ru/getItems
```

#### Параметры запроса

| Название | Маска | Описание |
|----------|-------|----------|
| **token** | `^\d+:[a-z0-9]{32}$` | Ключ авторизации, полученный при регистрации. |
| status    | `^(new\|approved)$`  | **new** — получить вопросы, не прошедшие модерацию, <br>**approved** — для прошедших модерацию. <br>По умолчанию вернутся оба типа вопросов. |

> Параметры, выделенные полужирным, являются обязательными.

#### Пример запроса

```bash
curl --include --request GET 'https://api.thisorthat.ru/getItems?token=1:0994f52572ab3f9432c77615c104db9c&status=approve'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "items": [
            {
                "item_id": "1926",
                "first_text": "Остаться слепым на всю жизнь",
                "last_text": "Остаться глухим на всю жизнь",
                "status": "approved",
                "first_vote": 3443,
                "last_vote": 11679
            },
            {
                "item_id": "5043",
                "first_text": "Быть нервным",
                "last_text": "Быть ранимым",
                "status": "approved",
                "first_vote": 7630,
                "last_vote": 7751
            }
    }
}
```

Ответ сервера содержит список объектов `items`. Клиент может перемешать вопросы после получения.

#### Описание полей вопроса

| Поле | Тип | Описание |
|------|-----|----------|
| item_id    | String  | Уникальный идентификатор вопроса. |
| first_text | String  | Текст первого вопроса длинной 4-150 символов. |
| last_text  | String  | Текст последнего вопроса длинной 4-150 символов. |
| status     | String  | **new** — новый вопрос, <br>**approved** — прошел модерацию. |
| first_vote | Integer |Количество ответов на первый вопрос. |
| last_vote  | Integer |Количество ответов на последний вопрос. |


## /getMyItems

Метод возвращает вопросы, которые добавил текущий пользователь.

```
GET|POST https://api.thisorthat.ru/getMyItems
```

#### Параметры запроса

| Название | Маска | Описание |
|----------|-------|----------|
| **token** | `^\d+:[a-z0-9]{32}$`  | Ключ авторизации, полученный при регистрации. |
| limit     | `^[1-9][0-9]?$\|100$` | Количество запрашиваемых вопросов в диапазоне 1-100. <br>По умолчанию равен _30_ |
| offset    | `^[0-9]+$`            | Смещение относительно первого вопросов. <br>По умолчанию равен _0_ |

> Параметры, выделенные полужирным, являются обязательными.

#### Пример запроса

```bash
curl --include --request GET 'https://api.thisorthat.ru/getMyItems?token=1:0994f52572ab3f9432c77615c104db9c&limit=2&offset=10'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "items": [
            {
                "item_id": "11",
                "first_text": "Прожить в тюрьме год",
                "last_text": "Пролежать в коме 2 года",
                "reason": "abuse",
                "status": "rejected",
                "first_vote": 6414,
                "last_vote": 10598
            },
            {
                "item_id": "12",
                "first_text": "Хотеть чихнуть каждую секунду своей жизни но не иметь возможности сделать это",
                "last_text": "Икать до конца жизни",
                "status": "approved",
                "first_vote": 12194,
                "last_vote": 4712
            }
        ],
        "total": 247
    }
}
```

Ответ сервера содержит список объектов `items`.  
Поле `total` типа `Integer` содержит общее количество вопросов в выборке. Например, для того, чтобы получить все 247 вопросов пользователя, 
нужно сделать 3 запроса по 100 вопрсов со смещением 0, 100 и 200 соответственно.

#### Описание полей вопроса

| Поле | Тип | Описание |
|------|-----|----------|
| item_id    | String  | Уникальный идентификатор вопроса. |
| first_text | String  | Текст первого вопроса длинной 4-150 символов. |
| last_text  | String  | Текст последнего вопроса длинной 4-150 символов. |
| status     | String  | **new** — новый вопрос, <br>**approved** — прошел модерацию, <br>**rejected** — вопрос отклонен. |
| reason     | String  | Причина отклонения вопроса. <br>**typo** — в вопросе ошибка, <br>**abuse** — некорректный вопрос, <br>**clone** — такой вопрос уже есть. |
| first_vote | Integer | Количество ответов на первый вопрос. |
| last_vote  | Integer | Количество ответов на последний вопрос. |

> Поле `reason` определено только для вопросов со статусом **rejected**.


## /addItem

Добавление нового вопроса от пользователя.

#### Запрос

```
GET|POST https://api.thisorthat.ru/addItem
```

#### Параметры запроса

| Параметр | Маска | Описание |
|----------|--------------|----------|
| **token**      | `^\d+:[a-z0-9]{32}$` | Ключ авторизации, полученный при регистрации. |
| **first_text** | `^.{4,150}$`         | Первый вопрос длинной 4-150 символов. |
| **last_text**  | `^.{4,150}$`         | Последний вопрос длинной 4-150 символов. |

Клиент должен провести предварительную фильтрацию вопросов.
> Все параметры запроса являются обязательными.  

#### Пример запроса

```bash
curl --include --request POST --data 'first_text=Visa&last_text=Mastercard' 'https://api.thisorthat.ru/addItem?token=1:0994f52572ab3f9432c77615c104db9c'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "item_id": "10000"
    }
}
```

Ответ сервера содержит `item_id` типа `String` добавленного вопроса. В случае ошибки клиент может отобразить на своей стороне результат поля `description`.

#### Ответ сервера с ошибкой

```json
{
    "ok": false,
    "description": "В нашей базе уже есть такой вопрос",
    "parameters": {
        "clone_id": "18007"
    }
}
```

В процессе добавления вопроса сервер проверяет текст на дубликаты. Если клон найден, сервер вернет ошибку и дополнительное поле `parameters`, 
содержащее параметр `clone_id` типа `String` с идентификатором похожего вопроса.
> Если поле `parameters.clone_id` не пустое, клиент может предложить добавить вопрос в избранное.


## /setViewed

Метод для добавления ответов пользователя. Позволяет отправить список значений одним запросом.

#### Запрос

```
GET|POST https://api.thisorthat.ru/setViewed
```

#### Параметры запроса

| Параметр | Маска | Описание |
|----------|--------------|----------|
| **token** | `^\d+:[a-z0-9]{32}$` | Ключ авторизации, полученный при регистрации. |
| **views** | `<Array>`            | Массив значений **first**, **last** или **skip** и id вопросов в качестве ключей.<br> Единовременно можно отправить до 1000 значений. |

Если не удалось получить ответ на вопрос (например, пользователь отправил жалобу), но необходимо засчитать просмотр, то следует отправить значение **skip**.
> Все параметры запроса являются обязательными.  


#### Пример запроса

```bash
curl --include --request POST --data 'views[100]=first&views[245]=last&views[376]=skip' 'https://api.thisorthat.ru/setViewed?token=1:0994f52572ab3f9432c77615c104db9c'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": true
}
```

В случае удачного выполнения сервер вернет `true`.


## /getFavorite

Получение списка вопросов, добавленных текущим пользователем в избранное.

#### Запрос

```
GET|POST https://api.thisorthat.ru/getFavorite
```

#### Параметры запроса

| Название | Маска | Описание |
|----------|-------|----------|
| **token** | `^\d+:[a-z0-9]{32}$`  | Ключ авторизации, полученный при регистрации. |
| limit     | `^[1-9][0-9]?$\|100$` | Количество запрашиваемых вопросов в диапазоне 1-100. <br>По умолчанию равен _30_ |
| offset    | `^[0-9]+$`            | Смещение относительно первого вопросов. <br>По умолчанию равен _0_ |

> Параметры, выделенные полужирным, являются обязательными.

#### Пример запроса

```bash
curl --include --request GET 'https://api.thisorthat.ru/getFavorite?token=1:0994f52572ab3f9432c77615c104db9c&limit=20&offset=10'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "items": [
            {
                "item_id": "11",
                "first_text": "Прожить в тюрьме год",
                "last_text": "Пролежать в коме 2 года",
                "status": "rejected",
                "first_vote": 6414,
                "last_vote": 10598
            },
            {
                "item_id": "16",
                "first_text": "Хотеть чихнуть каждую секунду своей жизни но не иметь возможности сделать это",
                "last_text": "Икать до конца жизни",
                "status": "approved",
                "first_vote": 12194,
                "last_vote": 4712
            }
        ],
        "total": 2
    }
}
```

Ответ сервера содержит список объектов `items`.  
Поле `total` типа `Integer` содержит общее количество вопросов в выборке. 

#### Описание полей вопроса

| Поле | Тип | Описание |
|------|-----|----------|
| item_id    | String  | Уникальный идентификатор вопроса. |
| first_text | String  | Текст первого вопроса длинной 4-150 символов. |
| last_text  | String  | Текст последнего вопроса длинной 4-150 символов. |
| status     | String  | **new** — новый вопрос, <br>**approved** — прошел модерацию, <br>**rejected** — вопрос отклонен. |
| first_vote | Integer | Количество ответов на первый вопрос. |
| last_vote  | Integer | Количество ответов на последний вопрос. |


## /addFavorite

Добавление вопроса в список избранного.

#### Запрос

```
GET|POST https://api.thisorthat.ru/addFavorite
```

#### Параметры запроса

| Параметр | Маска | Описание |
|----------|--------------|----------|
| **token**      | `^\d+:[a-z0-9]{32}$` | Ключ авторизации, полученный при регистрации. |
| **item_id**    | `^\d{1,11}$`         | Идентификатор вопроса, который нужно добавить в избранное. |

> Все параметры запроса являются обязательными.  

#### Пример запроса

```bash
curl --include --request POST --data 'item_id=10' 'https://api.thisorthat.ru/addFavorite?token=1:0994f52572ab3f9432c77615c104db9c'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": true
}
```

В случае удачного выполнения, даже если вопрос уже был в избранном, сервер вернет `true`. 


## /deleteFavorite

Удаление вопроса из списка избранного.

#### Запрос

```
GET|POST https://api.thisorthat.ru/deleteFavorite
```

#### Параметры запроса

| Параметр | Маска | Описание |
|----------|--------------|----------|
| **token**      | `^\d+:[a-z0-9]{32}$` | Ключ авторизации, полученный при регистрации. |
| **item_id**    | `^\d{1,11}$`         | Идентификатор вопроса, который нужно удалить из избранного. |

> Все параметры запроса являются обязательными.

#### Пример запроса

```bash
curl --include --request POST --data 'item_id=10' 'https://api.thisorthat.ru/deleteFavorite?token=1:0994f52572ab3f9432c77615c104db9c'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": true
}
```

В случае удачного выполнения, даже если вопроса не было в избранном, сервер вернет `true`. 


## /sendReport

Отправляет жалобу на конкретный вопрос.

#### Запрос

```
GET|POST https://api.thisorthat.ru/sendReport
```

#### Параметры запроса

| Название | Маска | Описание |
|----------|-------|----------|
| **token**   | `^\d+:[a-z0-9]{32}$`      | Ключ авторизации, полученный при регистрации. |
| **item_id** | `^\d{1,11}$`              | Идентификатор вопроса, на который отправляется жалоба. |
| **reason**  | `^(typo\|abuse\|clone)$`  | **typo** — в вопросе ошибка, <br>**abuse** — некорректный вопрос, <br>**clone** — такой вопрос уже есть. |

> Все параметры запроса являются обязательными.

#### Пример запроса

```bash
curl --include --request POST --data 'item_id=10&reason=typo' 'https://api.thisorthat.ru/sendReport?token=1:0994f52572ab3f9432c77615c104db9c'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": true
}
```

В случае удачного выполнения, сервер вернет `true`. 

