# То или Это: документация API

Все запросы к API должны быть выполнены через HTTPS и быть представлены в таком виде:

```
https://api.thisorthat.ru/<method_name>
```

Для всех запросов кроме `/register` поддерживаются HTTP методы **GET** и **POST**.  
Выбор HTTP метода ложится на плечи клиента, но стоит помнить, что запросы на изменение данных не должны кэшироваться.
Параметры запроса могут быть переданны одним из трех способов:

- [URL query string](https://en.wikipedia.org/wiki/Query_string)
- application/x-www-form-urlencoded
- multipart/form-data

Ответ содержит объект JSON, который всегда имеет логическое поле `ok`. Если `ok` равно true, значит запрос был выполнен успешно и результат запроса можно найти в поле `result`. В случае неудачного запроса, `ok` равно false и суть ошибки объясняется в поле `descriprion`. Некоторые ошибки могут также иметь необязательное поле `parameters`, которое может помочь автоматически обработать ошибку. Все такие случаи подробно описаны в пояснениях к конкретным методам.  
Для всех запросов сервер возвращает корректный [код состояния](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes) HTTP запроса.

- Все методы API не чувствительны к регистру
- Запросы должны выполняться с использованием кодировки UTF-8

Все методы кроме регистрации требуют обязательного параметра `token`, который клиент получает при регистрации.
При успешном вызове будет возвращен JSON-объект, содержащий результат.

## /register

Метод служит для регистрации клиента и получения токена авторизации.
Регистрацию следует выполнять только через **POST**.

#### Запрос

```
POST https://api.thisorthat.ru/register
```

#### Параметры
| Параметр | Маска | Описание |
|----------|--------------|----------|
| **client** | `^[a-z0-9-_]{0,16}$` | Название клиента, с которого выполняется авторизация. |
| **uniqid** | `^[a-z0-9-_]{0,64}$` | Уникальное для платформы значение, идентификатор пользователя или uuid. |

> Все параметры запроса являются обязательными

#### Пример запроса

```bash
curl --include --request POST --data 'client=vkontakte&uniqid=5655655' 'https://api.thisorthat.ru/register'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "token": "1:0994f52572ab3f9432c77615c104db9c"
    }
}
```

## /getItems

Возвращает список из **30** еще неотвеченных пользователем вопросов. Метод не возвращает отклоненные после модерации объекты.
> Этот метод может изменять поля базы данных

#### Запрос
```
GET|POST https://api.thisorthat.ru/getItems
```

#### Параметры запроса
| Название | Маска | Описание |
|----------|-------|----------|
| **token** | `^\d:[a-z0-9{32}$`   | Ключ авторизации, полученный при регистрации. |
| status    | `^(new\|approved)$`  | **new** — получить вопросы, не прошедшие модерацию, <br>**approved** — для прошедших модерацию. <br>По умолчанию вернутся оба типа вопросов. |

> Параметры, выделенные полужирным, являются обязательными

#### Пример запроса

```bash
curl --include --request GET 'https://api.thisorthat.ru/getItems?token=1:0994f52572ab3f9432c77615c104db9c&status=approve'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "items": {
            "200": {
                "first_text": "Легче вскрыть на жопе вены",
                "last_text": "Легче дождаться перемены",
                "status": "new",
                "first_vote" :"2712",
                "last_vote": "12125"
            }
        }
    }
}
```

Ответ сервера содержит список объектов `items`, отсортированный и сгруппированный по ключу — id вопроса. Клиент может перемешать вопросы после получения.

#### Описание полей вопроса

| Поле | Описание |
|------|----------|
| first_text | Текст первого вопроса длинной 4-150 символов. |
| last_text  | Текст последнего вопроса длинной 4-150 символов. |
| status     | **new** — новый вопрос, <br>**approved** — прошел модерацию. |
| first_vote | Количество ответов на первый вопрос. |
| last_vote  | Количество ответов на последний вопрос. |


## /getMyItems

Метод возвращает вопросы, которые добавил текущий пользователь.

```
GET|POST https://api.thisorthat.ru/getMyItems
```

#### Параметры запроса
| Название | Маска | Описание |
|----------|-------|----------|
| **token** | `^\d:[a-z0-9{32}$`    | Ключ авторизации, полученный при регистрации. |
| limit     | `^[1-9][0-9]?$\|100$` | Количество запрашиваемых вопросов в диапазоне 1-100. <br>По умолчанию равен _30_ |
| offset    | `^[0-9]+$`            | Смещение относительно первого вопросов. <br>По умолчанию равен _0_ |

> Параметры, выделенные полужирным, являются обязательными

#### Пример запроса

```bash
curl --include --request GET 'https://api.thisorthat.ru/getMyItems?token=1:0994f52572ab3f9432c77615c104db9c&limit=1&offset=10'
```

#### Ответ сервера

```json
{
    "ok": true,
    "result": {
        "items": {
            "100": {
                "first_text": "Вилкой в глаз",
                "last_text": "В жопу раз",
                "status": "rejected",
                "reason": "abuse",
                "first_vote" :"0",
                "last_vote": "0"
            }
        },
        "total": 240
    }
}
```

Ответ сервера содержит список объектов `items`, отсортированный и сгруппированный по ключу — id вопроса.  
Поле `total` содержит общее количество вопросов в выборке. Например, для того, чтобы получить все 240 вопросов пользователя, 
нужно сделать 3 запроса по 100 вопрсов со смещением 0, 100 и 200 соответственно.

#### Описание полей вопроса

| Поле | Описание |
|------|----------|
| first_text | Текст первого вопроса длинной 4-150 символов. |
| last_text  | Текст последнего вопроса длинной 4-150 символов. |
| status     | **new** — новый вопрос <br>**approved** — прошел модерацию, <br>**rejected** — вопрос отклонен. |
| reason     | Причина отклонения вопроса. <br>**typo** — в вопросе ошибка, <br>**abuse** — некорректный вопрос, <br>**clone** — такой вопрос уже есть. |
| first_vote | Количество ответов на первый вопрос. |
| last_vote  | Количество ответов на последний вопрос. |

> Поле `reason` определено только для вопросов со статусом **rejected**
